# ThreadStep - 実装機能一覧

## 📊 Dashboard ページ (`/`)

### ヒーローカード
- **今日のベストタイム表示**: 19:30（スコア95/100）
- **視覚的な時計アイコン**: 最適投稿時間を強調
- **推奨アクション**: "今すぐ予約する" ボタン → Composer画面へ遷移

### 今週の進捗
- **投稿数カウンター**: 3/5投稿完了
- **プログレスバー**: 視覚的な進捗表示（60%）
- **連続投稿日数**: 7日間連続でストリーク表示
- **ステータスインジケーター**: 🔥 絵文字で達成感を演出

### 承認待ち
- **承認待ちメッセージ数**: 2件
- **クイックアクション**: "確認する" ボタン → Inbox画面へ遷移

### 今週のインサイト
- **3つのインサイトカード**:
  1. 保存率が先週比+15%向上（緑色の上昇インジケーター）
  2. 朝7時の投稿が好調（青色の時計アイコン）
  3. 会話促進テンプレートの効果が高い（紫色のメッセージアイコン）

### 最近の投稿
- **投稿一覧**: 最新3件の投稿を表示
- **各投稿の情報**:
  - 投稿本文（2行まで表示）
  - 投稿日時（相対時間表示: "2時間前"）
  - エンゲージメント数（いいね、コメント、保存）
  - 状態バッジ（公開済み/予約済み）

---

## 📅 Calendar ページ (`/calendar`)

### 週次カレンダービュー
- **7日間の週表示**: 月曜日〜日曜日
- **時間スロット**: 6:00〜23:00の1時間刻み
- **スロット品質の可視化**:
  - 🟢 **Best**: 緑色（エンゲージメントスコア85以上）
  - 🔵 **Normal**: 青色（スコア70-84）
  - 🟠 **Avoid**: オレンジ色（スコア70未満）

### 投稿カード表示
- **カード配置**: 予約時間のスロットに自動配置
- **投稿状態の視覚化**:
  - ✅ 公開済み: 緑色のドット
  - 📅 予約済み: 青色のドット
  - ⏸️ 承認待ち: オレンジ色のドット
  - ❌ 失敗: 赤色のドット
- **本文プレビュー**: 40文字まで表示（...で省略）
- **クリックアクション**: 投稿モーダルを開く

### 空きスロットのインタラクション
- **クリック**: 新規投稿作成（Composerへ遷移、日時自動設定）
- **ホバー効果**: 半透明の背景色でハイライト

### 凡例とヘルプ
- **色の意味説明**:
  - 緑 = 最適な時間帯
  - 青 = 通常の時間帯
  - オレンジ = 避けるべき時間帯
- **使い方ガイド**:
  - 色付きスロット = エンゲージメント予測
  - 空きスロットクリック = 投稿作成
  - 投稿カードクリック = 編集・削除

### 投稿編集モーダル（NEW! ✨）
- **プレビュー機能**:
  - 投稿状態バッジ（公開済み/予約済み/下書き/承認待ち/失敗）
  - 投稿本文の全文表示
  - 添付メディアのグリッド表示（2カラム）
  - スケジュール日時（日本語フォーマット）
  - スロット品質バッジ（最適/通常/避ける）
  - メタ情報（作成日時、公開日時）

- **編集機能**:
  - 本文のテキストエリア編集
  - 文字数カウンター（500文字制限）
  - スケジュール日時の変更（datetime-local input）
  - 編集モードの切り替えボタン

- **エンゲージメント表示**（公開済み投稿のみ）:
  - いいね数（3カラムレイアウト）
  - コメント数
  - 保存数

- **アクション**:
  - 変更を保存ボタン
  - キャンセルボタン（編集内容を破棄）
  - 削除ボタン（確認ダイアログ付き）
  - 今すぐ公開ボタン（予約投稿を即時公開）

---

## ✍️ Composer ページ (`/composer`)

### テキストエディタ
- **マルチラインテキストエリア**: 投稿本文入力
- **文字数カウンター**: リアルタイム表示（500文字制限）
- **プレースホルダー**: "投稿内容を入力してください..."

### AI テンプレート提案
- **AI提案ボタン**: Sparkles アイコン + ローディング状態
- **3種類のテンプレート**:
  1. 📌 **保存誘導型**（Save）
     - 緑色のバッジ
     - リスト形式のコンテンツ
     - 保存を促す文言
     - 信頼度: 92%

  2. 💬 **会話促進型**（Talk）
     - 青色のバッジ
     - 質問形式のコンテンツ
     - コメントを促す文言
     - 信頼度: 88%

  3. 🎁 **告知型**（Promo）
     - 紫色のバッジ
     - 期間限定オファー
     - CTA（Call To Action）
     - 信頼度: 85%

- **提案カード**:
  - テンプレートタイプバッジ
  - 信頼度パーセンテージ
  - 本文プレビュー
  - ハッシュタグ表示
  - クリックで本文に適用

### テンプレート管理機能（NEW! ✨）
- **保存ボタン**: 現在の投稿内容をテンプレートとして保存
- **保存モーダル**:
  - テンプレート名入力欄
  - プレースホルダー: "例: 朝活投稿テンプレート"
  - 保存/キャンセルボタン
  - ハッシュタグ自動抽出

- **テンプレートライブラリ**:
  - トグル式の表示/非表示
  - 保存件数カウンター
  - テンプレート一覧表示:
    - テンプレート名（太字）
    - 本文プレビュー（2行まで）
    - ハッシュタグ（最大3つ）
    - 削除ボタン（ゴミ箱アイコン）
  - クリックで本文に読み込み
  - 空状態メッセージ: "保存されたテンプレートはありません"

### スケジュール設定
- **日時ピッカー**: datetime-local input
- **カレンダーアイコン**: 視覚的なガイド
- **URLパラメータ対応**: Calendar画面から日時が自動設定

### アクションボタン
- **予約するボタン**:
  - カレンダーアイコン
  - 本文とスケジュール日時が必須
  - クリックでCalendar画面へ遷移

- **今すぐ投稿ボタン**:
  - 送信アイコン
  - 本文のみ必須
  - セカンダリースタイル
  - クリックでDashboard画面へ遷移

---

## 📥 Inbox ページ (`/inbox`)

### 統合受信箱
- **DM と コメントを統合表示**: 1つの画面で管理
- **タブフィルター**:
  - すべて（7件）
  - DM（3件）
  - コメント（4件）
  - 承認待ち（2件）

### メッセージアイテム
- **各アイテムの情報**:
  - 送信者名（太字）
  - アバター（イニシャル表示）
  - メッセージ本文
  - 送信時刻（相対時間: "30分前"）
  - タイプバッジ（DM/コメント）

- **優先度表示**:
  - 🔴 高優先度: 赤いドット
  - 🟡 中優先度: 黄色いドット
  - 既読/未読状態

- **フラグ表示**:
  - ポジティブ（緑色のバッジ）
  - 保存意図（青色のバッジ）
  - 質問（オレンジ色のバッジ）

### AI 返信候補
- **3つの候補提案**:
  1. シンプルな返信
  2. 詳細な返信
  3. 質問を含む返信
- **信頼度スコア**: パーセンテージ表示
- **適用ボタン**: クリックで返信欄に自動入力

### アクション
- **返信ボタン**: 返信テキストエリアを表示
- **承認ボタン**: 自動返信を承認して送信
- **スキップボタン**: 後で対応

### 一括承認
- **選択チェックボックス**: 複数メッセージを選択
- **一括承認ボタン**: 選択した全てを一括処理
- **件数表示**: "2件を一括承認"

### シークレットリプライ機能（NEW! 🤫）
- **専用ボタン**: コメントタイプのみ表示
- **動作フロー**:
  1. 公開コメント: 軽い返信（"ありがとうございます！"）
  2. 非公開DM下書き: CV誘導（"保存ありがとうございます！特典送りましょうか？"）
- **成功メッセージ**: アラート表示
- **説明カード**:
  - 機能の仕組み説明
  - 3ステップのフロー図
  - 緑色の背景で強調

---

## ⚙️ Rules ページ (`/rules`)

### BAN回避の説明
- **警告カード**: 赤色の背景
- **リスク説明**:
  - 短時間での大量送信
  - 同一文言の繰り返し
  - 過度な自動化
- **推奨設定**:
  - DM: 10-15件/時間
  - コメント: 15-20件/時間
  - 30分以上のクールダウン

### 有効なルール一覧
- **ルールカード**:
  - ルール名（太字）
  - ON/OFF トグルスイッチ
  - トリガー種類（DM/コメント）
  - 条件の詳細表示
  - アクションタイプ
  - テンプレート本文
  - クールダウン時間
  - 自動/手動の区別

- **ルール例**:
  1. **保存お礼DM**:
     - トリガー: コメント
     - 条件: "保存" キーワード検知
     - アクション: DM送信
     - 承認必須

  2. **ポジティブコメント返信**:
     - トリガー: コメント
     - 条件: ポジティブ感情検知
     - アクション: 返信
     - 承認必須

  3. **特典リクエスト自動送信（Yes検知）** ✨:
     - トリガー: DM受信
     - 条件: Yesキーワード（はい/yes/お願い/ください/欲しい）
     - アクション: 特典リンクをDM送信
     - **自動送信（承認不要）**
     - クールダウン: 7日間

### Yes検知機能の説明（NEW! ✅）
- **専用説明カード**: 緑色のグラデーション背景
- **3ステップのフロー**:
  1. シークレットリプライでDM送信
  2. ユーザーが「はい」「お願いします」と返信
  3. 自動検知して特典リンクを送信
- **検知キーワード一覧**: 「はい」「yes」「お願い」「ください」「欲しい」など
- **白色のボックスで強調表示**

### プリセットテンプレート
- **3つのテンプレート**:
  1. 保存お礼DM
  2. ポジティブ返信
  3. **✅ Yes検知 → 特典自動送信**（緑色でハイライト）

- **各テンプレートの情報**:
  - テンプレート名
  - トリガー種類
  - キーワード一覧
  - アクションタイプ
  - テンプレート本文
  - "+" ボタンで追加

### テストセクション
- **テストメッセージ入力欄**: ルールをテスト
- **テスト実行ボタン**: マッチするルールを確認
- **結果表示**: どのルールが発火するかを表示

---

## 📈 Analytics ページ (`/analytics`)

### KPIカード（3つ）
1. **保存率**:
   - 現在値: 8.2%
   - 前週比: +1.2%（緑色の上昇矢印）
   - 目標: 10%

2. **コメント率**:
   - 現在値: 3.5%
   - 前週比: +0.8%（緑色の上昇矢印）
   - 目標: 5%

3. **平均返信時間**:
   - 現在値: 12分
   - 前週比: -8分（緑色の下降矢印）
   - 目標: 5分以内

### 保存率トレンドグラフ
- **折れ線グラフ**: 過去7日間の推移
- **X軸**: 日付（月/日）
- **Y軸**: 保存率（%）
- **データポイント**: 7つ
- **トレンド**: 上昇傾向を可視化

### テンプレート別パフォーマンス
- **3つのテンプレート比較カード**:
  1. **保存誘導テンプレート**:
     - 保存率: 12.3%
     - 使用回数: 45回
     - 緑色のプログレスバー

  2. **会話促進テンプレート**:
     - 保存率: 6.8%
     - 使用回数: 32回
     - 青色のプログレスバー

  3. **告知テンプレート**:
     - 保存率: 4.2%
     - 使用回数: 18回
     - 紫色のプログレスバー

### AIインサイト
- **4つのインサイトカード**:
  1. 朝7-9時の投稿が高パフォーマンス
  2. 質問形式の投稿がコメント率2倍
  3. 保存誘導テンプレートの効果が高い
  4. 返信速度が速いほどエンゲージメント向上
- **各カードに電球アイコン**: アクション可能なインサイト

---

## ⚙️ Settings ページ (`/settings`)

### BAN回避設定（NEW! 🛡️）
- **DM送信レート**:
  - スライダー: 1-30件/時間
  - 現在値の大きな数字表示
  - 推奨値（10-15件）を超えると警告
  - ⚠️ 20件超: 赤文字で「推奨値を超えています」
  - ✅ 20件以下: 緑文字で「安全範囲」

- **コメント送信レート**:
  - スライダー: 1-40件/時間
  - 推奨値（15-20件）を超えると警告
  - ⚠️ 30件超: 赤文字で警告
  - ✅ 30件以下: 緑文字で安全範囲

- **クールダウン時間**:
  - スライダー: 5-120分（5分刻み）
  - 同一ユーザーへの連続送信を防止
  - 現在値の大きな数字表示

- **推奨設定の説明**:
  - 黄色の背景カード
  - DM 10-15件/時間
  - コメント 15-20件/時間
  - クールダウン 30分以上

### 自動化設定
- **完全自動モード**:
  - トグルスイッチ（ON/OFF）
  - 説明: "ルールに一致したメッセージを承認なしで自動送信（リスク高）"
  - デフォルト: OFF（安全設計）

- **メッセージの多様化**:
  - トグルスイッチ（ON/OFF）
  - 説明: "語尾・絵文字をランダム化して機械的な印象を回避"
  - デフォルト: ON
  - **バリエーション例**（ONの時に表示）:
    - 「ありがとうございます！」
    - 「ありがとうございます😊」
    - 「ありがとうございますね！」
    - 「ありがとうございます✨」

### 通知設定
- **プッシュ通知マスタースイッチ**:
  - トグルスイッチ（ON/OFF）
  - 説明: "承認待ちメッセージ、高優先度DM、エラー時に通知"

- **個別通知設定**（マスタースイッチONの時に表示）:
  - ✅ 承認待ちメッセージ（デフォルトON）
  - ✅ 高優先度DM（デフォルトON）
  - ✅ 自動化エラー（デフォルトON）
  - 各項目にチェックボックス

### アカウント連携
- **Threads連携状態**:
  - アカウント名: @your_account
  - アバター（紫色のグラデーション）
  - 連携ステータス: "Threads連携済み"
  - 再連携ボタン

- **アクセストークン情報**:
  - 有効期限表示: "2025年2月28日まで"
  - 時計アイコン
  - グレーの背景カード

### 危険な操作
- **赤色のボーダーカード**:
  - すべてのルールを無効化ボタン（赤文字）
  - すべてのデータをリセットボタン（赤文字）
  - ホバー時に赤色の背景

### 設定保存
- **保存ボタン**: ページ上部に固定
- **保存確認**: アラートメッセージ

---

## 🧩 共通コンポーネント

### Button コンポーネント
- **4つのバリアント**:
  - Primary: 青色の背景
  - Secondary: グレーの背景
  - Ghost: 背景なし（ホバー時にグレー）
  - Danger: 赤色の背景

- **3つのサイズ**:
  - Small (sm): 小さいボタン
  - Medium (デフォルト): 標準サイズ
  - Large (lg): 大きいボタン

- **状態管理**:
  - ローディング状態
  - 無効化状態
  - ホバー効果

### Card コンポーネント
- **白背景のカード**: コンテンツのグループ化
- **丸角**: 8px
- **シャドウ**: 軽いドロップシャドウ
- **パディング**: 24px
- **ボーダー**: 薄いグレー

### WeekView コンポーネント
- **7日間のグリッド**: 月曜日〜日曜日
- **時間スロット**: 6:00〜23:00（18時間）
- **スロット品質の色分け**:
  - 緑: Best（スコア85以上）
  - 青: Normal（スコア70-84）
  - オレンジ: Avoid（スコア70未満）
- **投稿カードの配置**: scheduled_at に基づく自動配置
- **クリックイベント**: 投稿クリック、スロットクリック

### PostCard コンポーネント
- **コンパクトな投稿カード**: カレンダー用
- **状態インジケーター**:
  - ✅ 公開済み: 緑色のドット
  - 📅 予約済み: 青色のドット
  - ⏸️ 承認待ち: オレンジ色のドット
  - ❌ 失敗: 赤色のドット
- **本文プレビュー**: 40文字まで
- **ホバー効果**: シャドウ拡大

### PostModal コンポーネント（NEW! ✨）
- **フルスクリーンオーバーレイ**: 黒の半透明背景
- **モーダルウィンドウ**: 最大幅3xl、最大高さ90vh
- **スクロール対応**: 内容が多い場合にスクロール
- **閉じるボタン**: X アイコン（右上）
- **レスポンシブ**: モバイル対応（padding調整）

---

## 🎨 デザインシステム

### カラーパレット
- **Primary**: 青色（#3b82f6系）
- **Success**: 緑色（#10b981系）
- **Warning**: オレンジ色（#f59e0b系）
- **Danger**: 赤色（#ef4444系）
- **Slate**: グレー色（#64748b系）

### タイポグラフィ
- **見出し**: font-bold, text-2xl, text-slate-900
- **本文**: text-sm, text-slate-700
- **キャプション**: text-xs, text-slate-500

### スペーシング
- **カード間隔**: gap-6（24px）
- **セクション間隔**: mb-8（32px）
- **パディング**: p-6（24px）

### アニメーション
- **ホバー効果**: transition-all, hover:shadow-lg
- **ボタンホバー**: bg色の変化
- **カードホバー**: border色の変化

---

## 📦 データモデル

### Post
```typescript
{
  id: string
  account_id: string
  state: 'published' | 'scheduled' | 'draft' | 'needs_approval' | 'failed'
  caption: string
  media: string[]
  scheduled_at: string | null
  published_at: string | null
  slot_quality: 'best' | 'normal' | 'avoid' | null
  created_at: string
  metrics?: {
    likes: number
    comments: number
    saves: number
  }
}
```

### InboxItem
```typescript
{
  id: string
  type: 'dm' | 'comment'
  author_id: string
  author_name: string
  author_avatar?: string
  text: string
  ts: string
  priority: 'high' | 'medium' | 'low'
  flags: string[]
  is_read: boolean
  is_approved: boolean
  auto_reply_scheduled?: string
}
```

### Rule
```typescript
{
  id: string
  name: string
  trigger: 'dm' | 'comment'
  conditions: {
    keywords?: string[]
    sentiment?: 'positive' | 'negative' | 'neutral'
    follower_days?: number
  }
  action: {
    type: 'dm' | 'reply'
    template: string
  }
  auto: boolean
  cooldown_s: number
  is_active: boolean
  created_at: string
}
```

### BestTime
```typescript
{
  account_id: string
  weekday: number // 0-6 (日曜日=0)
  hour: number // 0-23
  score: number // 0-100
}
```

### SavedTemplate（NEW! ✨）
```typescript
{
  id: string
  name: string
  caption: string
  tags: string[]
  created_at: string
}
```

---

## 🚀 技術仕様

### フレームワーク
- **Next.js 14.2.33**: App Router使用
- **React 18**: サーバーコンポーネント対応
- **TypeScript**: 完全型安全

### スタイリング
- **Tailwind CSS 3.4**: ユーティリティファースト
- **Framer Motion**: アニメーションライブラリ
- **Lucide React**: アイコンライブラリ

### 状態管理
- **useState**: ローカル状態管理
- **Zustand**: グローバル状態管理（準備済み）

### ルーティング
- **App Router**: Next.js 14の新しいルーティング
- **Link コンポーネント**: クライアントサイドナビゲーション
- **useRouter**: プログラマティックナビゲーション
- **useSearchParams**: URLパラメータの取得

### データフェッチング
- **モックデータ**: `/lib/mock-data.ts`
- **API Routes**: 将来の実装に備えた構造

---

## 📝 実装状況サマリー

### ✅ 完全実装済み（7ページ）
1. Dashboard - KPI、推奨時間、進捗管理
2. Calendar - 週ビュー、投稿管理、編集モーダル
3. Composer - AI提案、テンプレート管理
4. Inbox - 統合受信箱、シークレットリプライ
5. Rules - 自動化設定、Yes検知
6. Analytics - 保存率分析
7. Settings - 完全な設定管理

### 🎯 主要機能（詳細）
- ✅ スロット品質の可視化
- ✅ AI テンプレート提案（3種類）
- ✅ テンプレート保存・管理
- ✅ 投稿編集モーダル
- ✅ シークレットリプライ
- ✅ Yes検知自動送信
- ✅ BAN回避設定（レート制限）
- ✅ メッセージ多様化
- ✅ 完全自動モード
- ✅ 通知設定
- ✅ エンゲージメント分析

### 🔜 今後の実装予定
- Threads API連携
- Supabase データベース統合
- 実際のAI推論（OpenAI/Anthropic）
- リアルタイム通知
- 複数アカウント対応
- チーム機能

---

## 🎓 UX設計原則

### 1. 1画面1タスク
- 各ページは1つの明確な目的を持つ
- 不要な情報を排除
- 次のアクションが明確

### 2. 半自動が基本
- 承認フローでリスク管理
- ユーザーが最終判断
- BAN回避の安全設計

### 3. 即時フィードバック
- ボタンクリックで即座に反応
- ローディング状態の表示
- 成功/エラーメッセージ

### 4. 可視化は最小限
- 意思決定に必要な指標のみ
- シンプルなグラフとカード
- 色で直感的に理解

### 5. 次の1アクションを必ず出す
- 推奨時間の表示
- "今すぐ予約する" ボタン
- "確認する" ボタン

---

## 📊 KPI設計

### 北極星KPI
- **保存率（Save Rate）**: 投稿の保存数 / リーチ数

### 主要KPI
1. **初回価値到達（TTV）**: ≦ 5分
2. **初動コメント率**: +20%向上
3. **DM/リプ応答SLA**: 50%短縮
4. **D30継続率**: > 55%

### 副次KPI
- コメント率
- 平均返信時間
- テンプレート使用率
- 自動化率

---

この機能一覧は、ThreadStepの現在の実装状況を完全に網羅しています。
全7ページ + 主要コンポーネントが実装済みで、すぐに使用できる状態です。
